<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Svg Alluvials</title>
  <link rel="stylesheet" href="css/svgstyle.css" />


</head>

<body>

  <section>
    <select id="drop">
            <option value="">Select one...</option>
            <option value="company_dock_platform">company_dock_platform</option>
            <option value="company_dock_vessel_platform">company_dock_vessel_platform</option>
            <option value="company_item_port_platform">company_item_port_platform</option>
            <option value="Item_Vessel_Platform">Item_Vessel_Platform</option>
            <option value="item-load-unload">item-load-unload</option>
            <option value="company-dock-vessel-platform-tagged">company-dock-vessel-platform-tagged</option>
            <option value="testsizesort">company-dock-vessel-platform-tagged-size</option>
            <option value="testautosort">company-dock-vessel-platform-tagged-auto</option>
            <option value="newdata-colection-to-platfrom-company">collection-to-platform (company)</option>
            <option value="newdata-colection-to-platfrom">collection-to-platform </option>
            <option value="newdata">newdatatest</option>
        </select>
  </section>
  <section id="graph">
  </section>
  <script src="js/jquery.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="js/svg-pan-zoom.js"></script>

  <script>
    var main_chart_svg = d3.select("section#graph")
      .append("svg")
      .attr("width", "100%")
      .attr("height", "100%")


    loadSvg2("newdata-colection-to-platfrom-company");

    function loadSvg2(graph) {
      $("#graph").empty();
      d3.xml(graph + ".svg", function(error, documentFragment) {
        if (error) {
          console.log(error);
          return;
        }

        var svgNode = documentFragment
          .getElementsByTagName("svg")[0];

        d3.select("section#graph").node().appendChild(svgNode)




        var innerSVG = d3.select("section#graph").select("svg")
        //.call(d3.zoom()
        //.scaleExtent([1, 2])
        //.on("zoom", zoom));

        function zoom() {
          innerSVG.attr("transform", d3.event.transform);
        }
        nodeClick();
        responsivefy(d3.select("section#graph").select("svg"));

        panZoomInstance = svgPanZoom("SVG", {
          zoomEnabled: true,
          controlIconsEnabled: true,
          fit: true,
          center: true,
          minZoom: 0.1
        });

        // zoom out
        panZoomInstance.zoom(0.2)

        $("#move").on("click", function() {
          // Pan by any values from -80 to 80
          panZoomInstance.panBy({
            x: Math.round(Math.random() * 160 - 80),
            y: Math.round(Math.random() * 160 - 80)
          })
        });

      });
    }





    function responsivefy(svg) {
      // get container + svg aspect ratio
      var container = d3.select(svg.node().parentNode),
        width = parseInt(svg.style("width")),
        height = parseInt(svg.style("height")),
        aspect = width / height;

      console.log(window.innerHeight);

      // add viewBox and preserveAspectRatio properties,
      // and call resize so that svg resizes on inital page load
      svg.attr("viewBox", "0 0 " + width + " " + height)
        .attr("preserveAspectRatio", "xMinYMid")
        .call(resize);

      // to register multiple listeners for same event type,
      // you need to add namespace, i.e., 'click.foo'
      // necessary if you call invoke this function for multiple svgs
      // api docs: https://github.com/mbostock/d3/wiki/Selections#on
      d3.select(window).on("resize." + container.attr("id"), resize);

      // get width of container and resize svg to fit it
      function resize() {
        var targetHeight = parseInt(window.innerHeight);
        svg.attr("height", targetHeight - 50);
        svg.attr("width", window.innerWidth);
      }
    }



    var nodeClick = function() {
      $(".node").click(function() {
        var parenttag = "." + $(this).find("text")[0].innerHTML.split(" ")[0];
        //$(".Team").addClass("selectedLink");
        if (ckSelect(parenttag)) {
          rmSelect(parenttag);
        } else {
          addSelect(parenttag);
        }

        //console.log(parenttag);
      });
    };


    $("#drop").change(function() {
      var end = this.value;
      loadSvg2(end);
      console.log(end);
    });

    function addSelect(selector) {
      var currentclasses = $(selector).attr("class").split(' ');
      //console.log(currentclasses);
      if (currentclasses.indexOf("selectedLink") == -1) {
        currentclasses.push("selectedLink");
        var newclasses = currentclasses.join(" ");
        console.log(newclasses);
        $(selector).attr("class", newclasses);
      }
      //console.log(currentclasses);
    }

    function ckSelect(selector) {
      var currentclasses = $(selector).attr("class").split(' ');
      //console.log(currentclasses);
      if (currentclasses.indexOf("selectedLink") == -1) {
        return false;
      }
      return true;
      //console.log(currentclasses);
    }

    function rmSelect(selector) {
      var currentclasses = $(selector).attr("class").split(' ');
      //console.log(currentclasses);
      if (currentclasses.indexOf("selectedLink") == -1) {

      } else {
        var idx = currentclasses.indexOf("selectedLink");
        currentclasses.splice(idx, 1);
        var newclasses = currentclasses.join(" ");
        console.log(newclasses);
        $(selector).attr("class", newclasses);

      }
      //console.log(currentclasses);
    }



    //loadSvg("#graph", "testautosort", nodeClick)
    // function loadSvg(selector, url, callback) {
    //   var target = document.querySelector(selector);
    //
    //   // If SVG is supported
    //   if (typeof SVGRect != "undefined") {
    //     // Request the SVG file
    //     var ajax = new XMLHttpRequest();
    //     ajax.open("GET", url + ".svg", true);
    //     ajax.send();
    //
    //     // Append the SVG to the target
    //     ajax.onload = function(e) {
    //       target.innerHTML = ajax.responseText;
    //       callback();
    //     }
    //   } else {
    //     // Fallback to png
    //     target.innerHTML = "<img src='" + url + ".png' />";
    //   }
    //
    // }
    // load the external svg from a file
  </script>

</body>

</html>
